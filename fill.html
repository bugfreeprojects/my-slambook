<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>üå∏ Fill My Slambook</title>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Josefin+Sans:wght@300;400;600&family=Abril+Fatface&display=swap" rel="stylesheet"/>
<style>
:root{--cream:#FFF8F0;--blush:#FFD6E0;--lavender:#E8D5F5;--mint:#C8F0E0;--coral:#FF8B6B;--periwinkle:#B8C5F5;--peach:#FFE0C8;--ink:#2D1B4E;--soft-ink:#6B5B8A;--paper:#FFFDF8;--shadow:rgba(45,27,78,.12);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--cream);font-family:'Josefin Sans',sans-serif;min-height:100vh;overflow-x:hidden;}
.scene{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 70% 60% at 10% 10%,rgba(255,214,224,.7),transparent),radial-gradient(ellipse 50% 40% at 90% 90%,rgba(232,213,245,.6),transparent),radial-gradient(ellipse 60% 50% at 50% 50%,rgba(200,240,224,.3),transparent),var(--cream);}
.scene::after{content:'';position:absolute;inset:0;background-image:repeating-linear-gradient(transparent,transparent 39px,rgba(180,160,200,.12) 39px,rgba(180,160,200,.12) 40px);}
.floaty-bg{position:fixed;pointer-events:none;z-index:1;font-size:1.8rem;animation:floatBg 15s ease-in-out infinite;opacity:.5;}
@keyframes floatBg{0%,100%{transform:translateY(0) rotate(-3deg);}50%{transform:translateY(-16px) rotate(6deg);}}
#loadScreen{position:fixed;inset:0;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--cream);}
.load-spinner{width:60px;height:60px;border:4px solid var(--blush);border-top-color:var(--coral);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:16px;}
@keyframes spin{to{transform:rotate(360deg);}}
.load-txt{font-family:'Caveat',cursive;font-size:1.4rem;color:var(--ink);}
#mainWrap{display:none;position:relative;z-index:10;max-width:780px;margin:0 auto;padding:24px 16px 60px;}
.banner{background:var(--paper);border-radius:4px 18px 18px 4px;padding:22px 24px 22px 36px;margin-bottom:20px;box-shadow:-3px 0 0 var(--coral),6px 6px 28px var(--shadow);position:relative;}
.banner::before{content:'';position:absolute;left:0;top:0;bottom:0;width:22px;background:linear-gradient(180deg,var(--blush),var(--coral) 50%,var(--blush));border-radius:4px 0 0 4px;}
.banner-name{font-family:'Caveat',cursive;font-size:2rem;color:var(--ink);margin-bottom:4px;}
.banner-name em{color:var(--coral);font-style:normal;}
.banner-sub{font-size:.78rem;color:var(--soft-ink);letter-spacing:.5px;}
.progress-wrap{margin-bottom:22px;background:var(--paper);border-radius:12px;padding:14px 18px;box-shadow:0 2px 12px var(--shadow);}
.prog-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.prog-label span:first-child{font-size:.72rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--soft-ink);}
#pct{font-family:'Caveat',cursive;font-size:1.1rem;color:var(--coral);}
.prog-track{height:8px;background:var(--blush);border-radius:4px;overflow:hidden;}
#progFill{height:100%;width:0;background:linear-gradient(90deg,var(--coral),#FF6190);border-radius:4px;transition:width .4s ease;}
.s-card{background:var(--paper);border-radius:14px;padding:22px;margin-bottom:18px;box-shadow:4px 4px 18px var(--shadow);border-left:4px solid var(--blush);animation:cardIn .5s ease both;}
@keyframes cardIn{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.s-title{font-family:'Caveat',cursive;font-size:1.45rem;color:var(--ink);margin-bottom:18px;padding-bottom:8px;border-bottom:1.5px dashed rgba(180,160,200,.3);}
.card-basics{border-left-color:var(--coral);}
.card-favs{border-left-color:var(--lavender);}
.card-dreams{border-left-color:var(--mint);}
.card-me{border-left-color:var(--periwinkle);}
.card-us{border-left-color:var(--peach);}
.card-music{border-left-color:#FFD6A5;}
.card-rapid{border-left-color:var(--coral);}
.card-last{border-left-color:var(--blush);}
.f-wrap{margin-bottom:14px;}
.f-wrap label{display:block;font-size:.68rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--soft-ink);margin-bottom:5px;}
.f-input{width:100%;padding:10px 14px;background:rgba(255,255,255,.7);border:1.5px solid rgba(180,160,200,.28);border-radius:9px;font-family:'Caveat',cursive;font-size:1.08rem;color:var(--ink);outline:none;transition:border-color .2s,box-shadow .2s;resize:none;}
.f-input:focus{border-color:var(--coral);box-shadow:0 0 0 3px rgba(255,139,107,.12);}
.f-input::placeholder{color:rgba(107,91,138,.3);font-style:italic;}
textarea.f-input{height:80px;}
.rf-group{margin-bottom:14px;}
.rf-q{display:block;font-size:.72rem;letter-spacing:1.2px;text-transform:uppercase;color:var(--soft-ink);margin-bottom:8px;}
.rf-options{display:flex;gap:10px;flex-wrap:wrap;}
.rf-btn{padding:9px 18px;border-radius:20px;border:1.5px solid rgba(180,160,200,.35);background:rgba(255,255,255,.6);font-family:'Caveat',cursive;font-size:1rem;color:var(--soft-ink);cursor:pointer;transition:all .18s;}
.rf-btn.selected{background:linear-gradient(135deg,var(--coral),#FF6190);color:white;border-color:transparent;transform:scale(1.05);}
.remember-wrap{margin-top:16px;}
.remember-wrap p{font-family:'Caveat',cursive;font-size:1.15rem;color:var(--ink);margin-bottom:10px;}
.remember-options{display:flex;gap:12px;flex-wrap:wrap;}
.remember-btn{padding:10px 22px;border-radius:20px;border:1.5px solid rgba(180,160,200,.35);background:rgba(255,255,255,.6);font-family:'Caveat',cursive;font-size:1.05rem;color:var(--soft-ink);cursor:pointer;transition:all .18s;}
.remember-btn.yes.selected{background:linear-gradient(135deg,#FF8B6B,#FF6190);color:white;border-color:transparent;}
.remember-btn.no{opacity:.5;text-decoration:line-through;}
.submit-area{text-align:center;margin-top:24px;}
.submit-btn{padding:14px 48px;background:linear-gradient(135deg,var(--coral),#FF6190);border:none;border-radius:50px;font-family:'Caveat',cursive;font-size:1.4rem;color:white;cursor:pointer;box-shadow:0 6px 24px rgba(255,139,107,.4);transition:transform .15s,box-shadow .15s;}
.submit-btn:hover{transform:translateY(-3px);box-shadow:0 10px 32px rgba(255,139,107,.5);}
.submit-btn:active{transform:translateY(1px);}
.submit-btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
#successScreen{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;text-align:center;padding:40px 20px;}
.success-book{background:var(--paper);border-radius:4px 20px 20px 4px;padding:40px 36px;max-width:420px;box-shadow:-4px 0 0 var(--coral),8px 8px 40px var(--shadow);animation:successPop .6s cubic-bezier(.34,1.56,.64,1);}
@keyframes successPop{from{transform:scale(.7);opacity:0;}to{transform:scale(1);opacity:1;}}
.success-emoji{font-size:3.5rem;display:block;margin-bottom:12px;animation:bounce 1s ease infinite;}
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-12px);}}
.success-title{font-family:'Caveat',cursive;font-size:2.2rem;color:var(--ink);margin-bottom:8px;}
.success-sub{font-size:.85rem;color:var(--soft-ink);line-height:1.6;}
</style>
</head>
<body>
<div class="scene"></div>
<span class="floaty-bg" style="top:8%;left:5%;animation-delay:0s;">üå∏</span>
<span class="floaty-bg" style="bottom:15%;right:6%;animation-delay:-6s;">‚ú®</span>
<span class="floaty-bg" style="top:45%;right:3%;animation-delay:-11s;">üíå</span>

<div id="loadScreen">
  <div class="load-spinner"></div>
  <div class="load-txt" id="loadTxt">Loading slambook‚Ä¶ üå∏</div>
</div>

<div id="mainWrap">
  <div class="banner">
    <div class="banner-name" id="ownerName"><em>Someone's</em> Slambook</div>
    <div class="banner-sub">fill this out & leave your mark forever üíå</div>
  </div>

  <div class="progress-wrap">
    <div class="prog-label"><span>Your Progress</span><span id="pct">0%</span></div>
    <div class="prog-track"><div id="progFill"></div></div>
  </div>

  <form id="slamForm">
    <div class="s-card card-basics" style="animation-delay:0s">
      <div class="s-title">üíå Basic Details</div>
      <div class="f-wrap"><label>Full Name *</label><input class="f-input trackable" type="text" name="full_name" placeholder="your full name" maxlength="100" required/></div>
      <div class="f-wrap"><label>Nickname</label><input class="f-input trackable" type="text" name="nickname" placeholder="what friends call you" maxlength="50"/></div>
      <div class="f-wrap"><label>Date of Birth</label><input class="f-input trackable" type="text" name="dob" placeholder="dd/mm/yyyy" maxlength="20"/></div>
      <div class="f-wrap"><label>Zodiac Sign</label><input class="f-input trackable" type="text" name="zodiac" placeholder="‚ôà Aries? ‚ôã Cancer?" maxlength="30"/></div>
      <div class="f-wrap"><label>Contact (optional)</label><input class="f-input trackable" type="text" name="contact" placeholder="Instagram, phone, etc." maxlength="100"/></div>
    </div>

    <div class="s-card card-favs" style="animation-delay:.05s">
      <div class="s-title">‚≠ê Favorites</div>
      <div class="f-wrap"><label>Favorite Color</label><input class="f-input trackable" type="text" name="fav_color" placeholder="üé®" maxlength="50"/></div>
      <div class="f-wrap"><label>Favorite Food</label><input class="f-input trackable" type="text" name="fav_food" placeholder="üçïüçúüç∞" maxlength="80"/></div>
      <div class="f-wrap"><label>Favorite Movie / Series</label><input class="f-input trackable" type="text" name="fav_movie" placeholder="üé¨" maxlength="100"/></div>
      <div class="f-wrap"><label>Favorite Singer / Band</label><input class="f-input trackable" type="text" name="fav_singer" placeholder="üé§" maxlength="100"/></div>
      <div class="f-wrap"><label>Favorite Actor / Actress</label><input class="f-input trackable" type="text" name="fav_actor" placeholder="‚≠ê" maxlength="100"/></div>
      <div class="f-wrap"><label>Favorite Place</label><input class="f-input trackable" type="text" name="fav_place" placeholder="üåç" maxlength="100"/></div>
      <div class="f-wrap"><label>Favorite Subject</label><input class="f-input trackable" type="text" name="fav_subject" placeholder="üìö" maxlength="80"/></div>
      <div class="f-wrap"><label>Favorite Hobby</label><input class="f-input trackable" type="text" name="fav_hobby" placeholder="üéÆüé®üì∏" maxlength="100"/></div>
      <div class="f-wrap"><label>Favorite Season</label><input class="f-input trackable" type="text" name="fav_season" placeholder="üå∏‚òÄÔ∏èüçÇ‚ùÑÔ∏è" maxlength="30"/></div>
      <div class="f-wrap"><label>Favorite Quote</label><textarea class="f-input trackable" name="fav_quote" placeholder="words you live by‚Ä¶"></textarea></div>
    </div>

    <div class="s-card card-dreams" style="animation-delay:.1s">
      <div class="s-title">üéØ Dreams & Goals</div>
      <div class="f-wrap"><label>Biggest Goal in Life</label><textarea class="f-input trackable" name="goal" placeholder="dream big ‚ú®"></textarea></div>
      <div class="f-wrap"><label>Dream Job</label><input class="f-input trackable" type="text" name="dream_job" placeholder="what you want to be" maxlength="100"/></div>
      <div class="f-wrap"><label>Where do you see yourself in 10 years?</label><textarea class="f-input trackable" name="in_10_years" placeholder="paint the picture‚Ä¶"></textarea></div>
      <div class="f-wrap"><label>One Thing You Want to Achieve</label><input class="f-input trackable" type="text" name="want_to_achieve" placeholder="before you die üåü" maxlength="200"/></div>
    </div>

    <div class="s-card card-me" style="animation-delay:.15s">
      <div class="s-title">üí≠ About Me</div>
      <div class="f-wrap"><label>3 Words That Describe You</label><input class="f-input trackable" type="text" name="three_words" placeholder="funny, chaotic, kind‚Ä¶" maxlength="100"/></div>
      <div class="f-wrap"><label>Biggest Fear</label><input class="f-input trackable" type="text" name="biggest_fear" placeholder="üï∑Ô∏èüëªüåä" maxlength="150"/></div>
      <div class="f-wrap"><label>Your Biggest Strength</label><input class="f-input trackable" type="text" name="strength" placeholder="what makes you amazing?" maxlength="150"/></div>
      <div class="f-wrap"><label>Hidden Talent</label><input class="f-input trackable" type="text" name="hidden_talent" placeholder="secret skill unlocked üîì" maxlength="150"/></div>
      <div class="f-wrap"><label>Most Embarrassing Moment</label><textarea class="f-input trackable" name="embarrassing_moment" placeholder="spill it üëÄ"></textarea></div>
      <div class="f-wrap"><label>Biggest Crush üòè</label><input class="f-input trackable" type="text" name="crush" placeholder="name them or keep it mysterious" maxlength="100"/></div>
    </div>

    <div class="s-card card-us" style="animation-delay:.2s">
      <div class="s-title">üëÄ About Us</div>
      <div class="f-wrap"><label>Your First Impression of Me</label><textarea class="f-input trackable" name="first_impression" placeholder="what did you think when we first met?"></textarea></div>
      <div class="f-wrap"><label>What Changed After Getting to Know Me?</label><textarea class="f-input trackable" name="what_changed" placeholder="how did your opinion change?"></textarea></div>
      <div class="f-wrap"><label>Our Favorite Memory Together</label><textarea class="f-input trackable" name="fav_memory" placeholder="that one time‚Ä¶ üåü"></textarea></div>
      <div class="f-wrap"><label>What You Like Most About Me</label><textarea class="f-input trackable" name="like_most" placeholder="be honest üíñ"></textarea></div>
      <div class="f-wrap"><label>What Annoys You About Me üòÖ</label><input class="f-input trackable" type="text" name="annoys_me" placeholder="real talk‚Ä¶" maxlength="200"/></div>
      <div class="f-wrap"><label>A Secret Between Just Us</label><textarea class="f-input trackable" name="secret_between_us" placeholder="shhh ü§´"></textarea></div>
      <div class="f-wrap"><label>If Our Friendship Was a Movie Title</label><input class="f-input trackable" type="text" name="movie_title" placeholder="üé¨" maxlength="150"/></div>
    </div>

    <div class="s-card card-music" style="animation-delay:.25s">
      <div class="s-title">üéµ Just For You</div>
      <div class="f-wrap"><label>A Song I'd Dedicate to You</label><input class="f-input trackable" type="text" name="dedicate_song" placeholder="üé∂ song name + artist" maxlength="150"/></div>
      <div class="f-wrap"><label>A Line From That Song</label><textarea class="f-input trackable" name="song_line" placeholder="the lyric that reminds me of you‚Ä¶"></textarea></div>
      <div class="f-wrap"><label>If Our Friendship Had a Theme Song</label><input class="f-input trackable" type="text" name="theme_song" placeholder="üéµ" maxlength="150"/></div>
    </div>

    <div class="s-card card-rapid" style="animation-delay:.3s">
      <div class="s-title">üî• Rapid Fire</div>
      <div id="rfContainer"></div>
    </div>

    <div class="s-card card-last" style="animation-delay:.35s">
      <div class="s-title">üíñ One Last Thing</div>
      <div class="f-wrap"><label>A Message For Me</label><textarea class="f-input trackable" name="message" placeholder="pour your heart out üíå" style="height:120px;"></textarea></div>
      <div class="remember-wrap">
        <p>Will you remember me? ü•∫</p>
        <div class="remember-options">
          <button type="button" class="remember-btn yes" id="remYes" onclick="pickRemember('Yes! Always üíñ')">Yes! Always üíñ</button>
          <button type="button" class="remember-btn no" id="remNo" onclick="pickRemember('No option not allowed üòå')">No ‚Äî wait, nope!</button>
        </div>
        <input type="hidden" name="remember_me" id="remVal" value="Yes! Always üíñ"/>
      </div>
    </div>

    <div class="submit-area">
      <button type="submit" class="submit-btn" id="submitBtn">üíå Slam It &amp; Send!</button>
    </div>
  </form>

  <div id="successScreen">
    <div class="success-book">
      <span class="success-emoji">üå∏</span>
      <div class="success-title">Slammed! üíå</div>
      <div class="success-sub" id="successMsg">Your words have been delivered!</div>
    </div>
  </div>
</div>

<script>
const SUPA_URL='https://axysorsklatueeefvnyp.supabase.co';
const SUPA_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4eXNvcnNrbGF0dWVlZWZ2bnlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIzMTk1MzAsImV4cCI6MjA4Nzg5NTUzMH0.FPKfSFiYKezU292ZA3__GFngsV14PqIM2HU9sf69L1Y';
const H={'Content-Type':'application/json','apikey':SUPA_KEY,'Authorization':'Bearer '+SUPA_KEY};

async function sbFetch(path,opts={}){
  const r=await fetch(SUPA_URL+path,{...opts,headers:{...H,...(opts.headers||{})}});
  const d=await r.json().catch(()=>({}));
  return{ok:r.ok,status:r.status,data:d};
}

/* Rapid fire */
const rfData=[
  {name:'coffee_tea',q:'‚òï Coffee or üçµ Tea?',a:['Coffee ‚òï','Tea üçµ']},
  {name:'night_day',q:'üåô Night or ‚òÄÔ∏è Day?',a:['Night üåô','Day ‚òÄÔ∏è']},
  {name:'love_money',q:'üíï Love or üí∞ Money?',a:['Love üíï','Money üí∞']},
  {name:'call_text',q:'üìû Call or üí¨ Text?',a:['Call üìû','Text üí¨']},
  {name:'mountains_beach',q:'‚õ∞Ô∏è Mountains or üèñÔ∏è Beach?',a:['Mountains ‚õ∞Ô∏è','Beach üèñÔ∏è']},
  {name:'intro_extro',q:'üôà Introvert or ü¶ã Extrovert?',a:['Introvert üôà','Extrovert ü¶ã']},
];
const rfVals={};
const rfContainer=document.getElementById('rfContainer');
rfData.forEach(item=>{
  rfVals[item.name]='';
  const div=document.createElement('div');
  div.className='rf-group';
  div.innerHTML=`<span class="rf-q">${item.q}</span><div class="rf-options">
    <button type="button" class="rf-btn trackable" data-name="${item.name}" data-val="${item.a[0]}">${item.a[0]}</button>
    <button type="button" class="rf-btn trackable" data-name="${item.name}" data-val="${item.a[1]}">${item.a[1]}</button>
  </div>`;
  rfContainer.appendChild(div);
});
rfContainer.addEventListener('click',e=>{
  const btn=e.target.closest('.rf-btn');
  if(!btn)return;
  rfVals[btn.dataset.name]=btn.dataset.val;
  rfContainer.querySelectorAll(`.rf-btn[data-name="${btn.dataset.name}"]`).forEach(b=>b.classList.toggle('selected',b===btn));
  updateProgress();
});

function pickRemember(val){
  document.getElementById('remVal').value=val;
  document.getElementById('remYes').classList.toggle('selected',val.startsWith('Yes'));
  document.getElementById('remNo').classList.toggle('selected',val.startsWith('No'));
}
pickRemember('Yes! Always üíñ');

function updateProgress(){
  const inputs=document.querySelectorAll('input.trackable,textarea.trackable');
  let filled=inputs.length?[...inputs].filter(el=>el.value.trim()).length:0;
  const rfFilled=Object.values(rfVals).filter(v=>v).length;
  const total=inputs.length+rfData.length;
  const pct=total?Math.min(100,Math.round(((filled+rfFilled)/total)*100)):0;
  document.getElementById('pct').textContent=pct+'%';
  document.getElementById('progFill').style.width=pct+'%';
}
document.querySelectorAll('.f-input.trackable').forEach(el=>el.addEventListener('input',updateProgress));

/* Init ‚Äî load owner name */
const token=new URLSearchParams(location.search).get('s')||'';
let ownerProfile=null;

async function init(){
  if(!token){document.getElementById('loadTxt').textContent='‚ùå Invalid link.';return;}
  const r=await sbFetch(`/rest/v1/profiles?slambook_token=eq.${encodeURIComponent(token)}&select=id,username`);
  if(!r.ok||!r.data.length){
    document.getElementById('loadTxt').textContent='‚ùå Slambook not found!';return;
  }
  ownerProfile=r.data[0];
  document.getElementById('loadScreen').style.display='none';
  document.getElementById('mainWrap').style.display='block';
  document.getElementById('ownerName').innerHTML=`<em>${ownerProfile.username}'s</em> Slambook`;
  document.title='üå∏ '+ownerProfile.username+"'s Slambook";
}
init();

/* Submit */
document.getElementById('slamForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const btn=document.getElementById('submitBtn');
  btn.disabled=true;btn.textContent='Sending‚Ä¶ üíå';

  if(!ownerProfile){alert('Invalid slambook link!');btn.disabled=false;btn.textContent='üíå Slam It & Send!';return;}

  const fd=new FormData(e.target);
  const payload={owner_id:ownerProfile.id};
  fd.forEach((v,k)=>payload[k]=String(v).trim().slice(0,500));
  Object.assign(payload,rfVals);

  if(!payload.full_name){
    btn.disabled=false;btn.textContent='üíå Slam It & Send!';
    alert('Please enter your full name!');return;
  }

  const r=await sbFetch('/rest/v1/responses',{
    method:'POST',
    headers:{'Prefer':'return=minimal'},
    body:JSON.stringify(payload)
  });

  if(!r.ok){
    btn.disabled=false;btn.textContent='üíå Slam It & Send!';
    alert('Something went wrong. Please try again!');return;
  }

  document.getElementById('slamForm').style.display='none';
  document.querySelector('.banner').style.display='none';
  document.querySelector('.progress-wrap').style.display='none';
  const ss=document.getElementById('successScreen');
  ss.style.display='flex';
  document.getElementById('successMsg').textContent=`Your words have been delivered to ${ownerProfile.username}! üíå`;
});
</script>
</body>
</html>