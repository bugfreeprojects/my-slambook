<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ğŸŒ¸ My Slambook</title>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Josefin+Sans:wght@300;400;600&family=Playfair+Display:ital@0;1&display=swap" rel="stylesheet"/>
<style>
:root{
  --cream:#FFF8F0;--blush:#FFD6E0;--lavender:#E8D5F5;--mint:#C8F0E0;
  --gold:#F5C842;--coral:#FF8B6B;--periwinkle:#B8C5F5;
  --ink:#2D1B4E;--soft-ink:#6B5B8A;--paper:#FFFDF8;
  --shadow:rgba(45,27,78,.12);
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
  background:var(--cream);
  font-family:'Josefin Sans',sans-serif;
  min-height:100vh;
  overflow-x:hidden;
}

/* â”€â”€â”€ BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bg-scene{
  position:fixed;inset:0;z-index:0;
  background:
    radial-gradient(ellipse 80% 50% at 20% 20%,rgba(232,213,245,.6),transparent),
    radial-gradient(ellipse 60% 40% at 80% 80%,rgba(255,214,224,.5),transparent),
    radial-gradient(ellipse 50% 60% at 50% 50%,rgba(200,240,224,.3),transparent),
    var(--cream);
}
/* Doodle lines */
.bg-scene::before{
  content:'';position:absolute;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23E8D5F5' stroke-width='0.5'%3E%3Ccircle cx='30' cy='30' r='20'/%3E%3C/g%3E%3C/svg%3E");
  opacity:.4;
}
.floating-shape{
  position:fixed;pointer-events:none;z-index:1;
  border-radius:50%;
  animation:shapeFloat 20s ease-in-out infinite;
}
@keyframes shapeFloat{
  0%,100%{transform:translate(0,0) rotate(0deg);}
  33%{transform:translate(15px,-25px) rotate(5deg);}
  66%{transform:translate(-10px,15px) rotate(-3deg);}
}

/* â”€â”€â”€ FLOATING STICKERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.floaty{
  position:fixed;pointer-events:none;z-index:1;
  font-size:2rem;
  animation:floaty 18s ease-in-out infinite;
  filter:drop-shadow(2px 4px 8px var(--shadow));
}
@keyframes floaty{
  0%,100%{transform:translateY(0) rotate(-5deg);}
  50%{transform:translateY(-20px) rotate(5deg);}
}

/* â”€â”€â”€ PAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page{display:none;min-height:100vh;position:relative;z-index:10;}
.page.active{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px 20px;}

/* â”€â”€â”€ AUTH PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#authPage{
  background:transparent;
}
.auth-book{
  background:var(--paper);
  border-radius:4px 20px 20px 4px;
  width:100%;max-width:480px;
  box-shadow:
    -4px 0 0 #D4B5C0,
    8px 8px 40px rgba(45,27,78,.15),
    -2px 0 0 #C9A8B5;
  position:relative;
  overflow:hidden;
  animation:bookIn .8s cubic-bezier(.34,1.56,.64,1) forwards;
}
@keyframes bookIn{
  from{transform:scale(.8) rotateY(-15deg);opacity:0;}
  to{transform:scale(1) rotateY(0);opacity:1;}
}
.auth-book::before{
  content:'';
  position:absolute;left:0;top:0;bottom:0;width:36px;
  background:linear-gradient(180deg,#E8B4C0,#D4A0B0 40%,#E8B4C0);
  border-right:2px solid rgba(255,255,255,.5);
}
/* Ruling lines */
.auth-book::after{
  content:'';position:absolute;inset:0;
  background-image:repeating-linear-gradient(
    transparent,transparent 31px,rgba(180,160,200,.2) 31px,rgba(180,160,200,.2) 32px
  );
  pointer-events:none;
}
.auth-inner{padding:40px 40px 40px 60px;position:relative;z-index:2;}
.auth-title{
  font-family:'Caveat',cursive;
  font-size:2.6rem;color:var(--ink);
  margin-bottom:4px;line-height:1;
}
.auth-title span{color:var(--coral);}
.auth-sub{
  font-family:'Caveat',cursive;
  font-size:1rem;color:var(--soft-ink);
  margin-bottom:28px;
}
.auth-tabs{
  display:flex;gap:0;margin-bottom:24px;
  border-bottom:2px solid var(--blush);
}
.tab-btn{
  flex:1;padding:8px;
  background:none;border:none;
  font-family:'Josefin Sans',sans-serif;
  font-size:.8rem;letter-spacing:2px;text-transform:uppercase;
  color:var(--soft-ink);cursor:pointer;
  transition:all .2s;
  border-bottom:2px solid transparent;
  margin-bottom:-2px;
}
.tab-btn.active{color:var(--coral);border-bottom-color:var(--coral);}

.auth-form{display:none;}
.auth-form.active{display:block;}

.field-group{margin-bottom:16px;}
.field-group label{
  display:block;
  font-size:.7rem;letter-spacing:2px;text-transform:uppercase;
  color:var(--soft-ink);margin-bottom:5px;
}
.field-group input{
  width:100%;padding:10px 14px;
  background:rgba(255,255,255,.6);
  border:1.5px solid rgba(180,160,200,.3);
  border-radius:8px;
  font-family:'Caveat',cursive;
  font-size:1.1rem;color:var(--ink);
  outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.field-group input:focus{
  border-color:var(--coral);
  box-shadow:0 0 0 3px rgba(255,139,107,.1);
}
.error-msg{
  font-size:.75rem;color:#e05a5a;
  margin-top:4px;display:none;
}
.auth-btn{
  width:100%;padding:12px;
  background:linear-gradient(135deg,var(--coral),#FF6B9E);
  border:none;border-radius:10px;
  font-family:'Caveat',cursive;
  font-size:1.3rem;letter-spacing:1px;
  color:white;cursor:pointer;
  margin-top:8px;
  transition:transform .15s,box-shadow .2s;
  box-shadow:0 4px 20px rgba(255,139,107,.4);
}
.auth-btn:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(255,139,107,.5);}
.auth-btn:active{transform:translateY(0);}

/* â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#dashPage{
  background:transparent;
  align-items:stretch;
  justify-content:flex-start;
  padding:0;
}
.dash-header{
  background:white;
  padding:16px 32px;
  display:flex;align-items:center;justify-content:space-between;
  box-shadow:0 2px 20px var(--shadow);
  position:sticky;top:0;z-index:100;
}
.dash-logo{
  font-family:'Caveat',cursive;
  font-size:1.8rem;color:var(--ink);
}
.dash-logo span{color:var(--coral);}
.dash-user{
  display:flex;align-items:center;gap:12px;
}
.user-bubble{
  width:36px;height:36px;border-radius:50%;
  background:linear-gradient(135deg,var(--lavender),var(--blush));
  display:flex;align-items:center;justify-content:center;
  font-family:'Caveat',cursive;font-size:1rem;color:var(--ink);
  font-weight:700;
}
.username-lbl{font-size:.85rem;color:var(--soft-ink);letter-spacing:1px;}
.logout-btn{
  padding:6px 14px;border:1.5px solid var(--blush);border-radius:20px;
  background:none;font-family:'Josefin Sans',sans-serif;
  font-size:.75rem;letter-spacing:1px;color:var(--soft-ink);cursor:pointer;
  transition:all .2s;
}
.logout-btn:hover{background:var(--blush);color:var(--ink);}

.dash-body{
  flex:1;padding:32px;
  max-width:1000px;margin:0 auto;width:100%;
}

/* Link box */
.link-card{
  background:white;
  border-radius:16px;
  padding:28px;
  margin-bottom:28px;
  box-shadow:0 4px 24px var(--shadow);
  border:1.5px dashed rgba(255,139,107,.3);
  position:relative;
  overflow:hidden;
}
.link-card::before{
  content:'ğŸ“®';
  position:absolute;top:-10px;right:20px;
  font-size:3rem;opacity:.15;
}
.link-card h3{
  font-family:'Caveat',cursive;
  font-size:1.5rem;color:var(--ink);margin-bottom:6px;
}
.link-card p{font-size:.8rem;color:var(--soft-ink);margin-bottom:16px;letter-spacing:.5px;}
.link-box{
  display:flex;gap:10px;align-items:center;
  background:var(--cream);border-radius:10px;
  padding:12px 16px;
  border:1px solid rgba(180,160,200,.3);
}
.link-box span{
  font-family:'Caveat',cursive;
  font-size:1rem;color:var(--coral);
  flex:1;word-break:break-all;
}
.copy-btn{
  padding:8px 16px;
  background:linear-gradient(135deg,var(--coral),#FF6B9E);
  border:none;border-radius:8px;
  font-family:'Josefin Sans',sans-serif;
  font-size:.75rem;letter-spacing:1px;
  color:white;cursor:pointer;white-space:nowrap;
  transition:transform .15s;
}
.copy-btn:hover{transform:scale(1.05);}

/* Section heading */
.section-head{
  font-family:'Caveat',cursive;
  font-size:1.8rem;color:var(--ink);
  margin-bottom:20px;
  display:flex;align-items:center;gap:10px;
}
.section-head::after{
  content:'';flex:1;height:1px;
  background:linear-gradient(90deg,rgba(180,160,200,.4),transparent);
}

/* Response cards grid */
.responses-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:20px;
}
.r-card{
  background:var(--paper);
  border-radius:12px;
  padding:20px;
  box-shadow:4px 4px 20px var(--shadow);
  cursor:pointer;
  transition:transform .2s,box-shadow .2s;
  position:relative;
  border-top:3px solid var(--blush);
  animation:cardIn .4s ease forwards;
  transform:translateY(16px);opacity:0;
}
.r-card:hover{
  transform:translateY(-4px) rotate(.5deg);
  box-shadow:6px 8px 30px var(--shadow);
}
@keyframes cardIn{to{transform:translateY(0);opacity:1;}}
.r-card .sticker{
  position:absolute;top:-14px;right:14px;
  font-size:1.8rem;
  animation:wobble 3s ease-in-out infinite;
}
@keyframes wobble{
  0%,100%{transform:rotate(-5deg);}
  50%{transform:rotate(8deg);}
}
.r-name{
  font-family:'Caveat',cursive;
  font-size:1.4rem;color:var(--ink);margin-bottom:2px;
}
.r-nick{font-size:.75rem;color:var(--soft-ink);letter-spacing:1px;margin-bottom:10px;}
.r-preview{font-size:.8rem;color:var(--soft-ink);line-height:1.6;font-style:italic;}
.r-time{font-size:.65rem;color:rgba(107,91,138,.4);margin-top:10px;}
.r-badge{
  display:inline-block;
  padding:3px 10px;border-radius:20px;
  background:var(--lavender);
  font-size:.65rem;letter-spacing:1px;
  color:var(--soft-ink);margin-top:6px;
}

.empty-state{
  text-align:center;padding:60px 20px;
  grid-column:1/-1;
}
.empty-state .emoji{font-size:4rem;display:block;margin-bottom:16px;}
.empty-state h4{font-family:'Caveat',cursive;font-size:1.5rem;color:var(--ink);margin-bottom:8px;}
.empty-state p{font-size:.8rem;color:var(--soft-ink);letter-spacing:.5px;}

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast{
  position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(20px);
  background:var(--ink);color:white;
  font-family:'Caveat',cursive;font-size:1.1rem;
  padding:12px 28px;border-radius:50px;
  z-index:9999;opacity:0;
  transition:all .3s;pointer-events:none;
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* â”€â”€â”€ MODAL (view full response) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#modal{
  position:fixed;inset:0;z-index:1000;
  background:rgba(45,27,78,.5);backdrop-filter:blur(8px);
  display:none;align-items:center;justify-content:center;padding:20px;
}
#modal.open{display:flex;}
.modal-book{
  background:var(--paper);
  border-radius:4px 20px 20px 4px;
  max-width:700px;width:100%;
  max-height:90vh;overflow-y:auto;
  box-shadow:-4px 0 0 #D4B5C0, 8px 8px 50px rgba(45,27,78,.3);
  position:relative;animation:modalIn .4s cubic-bezier(.34,1.56,.64,1);
}
@keyframes modalIn{from{transform:scale(.85);opacity:0;}to{transform:scale(1);opacity:1;}}
.modal-spine{
  position:sticky;top:0;
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 28px 20px 20px;
  background:linear-gradient(135deg,var(--lavender),var(--blush));
  border-radius:0 20px 0 0;
  z-index:2;
}
.modal-name{font-family:'Caveat',cursive;font-size:2rem;color:var(--ink);}
.close-btn{
  width:32px;height:32px;border-radius:50%;
  background:white;border:none;cursor:pointer;
  font-size:1.2rem;display:flex;align-items:center;justify-content:center;
  box-shadow:0 2px 10px var(--shadow);transition:transform .2s;
}
.close-btn:hover{transform:scale(1.1);}
.modal-content{padding:28px;}

/* Section blocks in modal */
.q-section{margin-bottom:28px;}
.q-section-title{
  font-family:'Caveat',cursive;
  font-size:1.2rem;color:var(--coral);
  border-bottom:1.5px dashed rgba(255,139,107,.3);
  padding-bottom:6px;margin-bottom:14px;
}
.q-row{
  display:flex;gap:8px;margin-bottom:10px;
  padding-bottom:10px;
  border-bottom:1px solid rgba(180,160,200,.15);
  flex-direction:column;
}
.q-label{
  font-size:.7rem;letter-spacing:1.5px;text-transform:uppercase;
  color:var(--soft-ink);
}
.q-value{
  font-family:'Caveat',cursive;
  font-size:1.1rem;color:var(--ink);line-height:1.4;
}
.q-value.empty{color:rgba(107,91,138,.3);font-style:italic;font-size:.9rem;}

.rapid-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.rapid-item{
  background:var(--lavender);border-radius:8px;padding:10px 14px;
}

/* Print button */
.print-btn{
  margin:0 28px 28px;
  padding:10px;width:calc(100% - 56px);
  background:var(--mint);border:none;border-radius:10px;
  font-family:'Caveat',cursive;font-size:1.1rem;color:var(--ink);
  cursor:pointer;transition:transform .15s;
}
.print-btn:hover{transform:scale(1.02);}
</style>
</head>
<body>

<!-- Background -->
<div class="bg-scene"></div>
<div class="floating-shape" style="width:200px;height:200px;background:radial-gradient(var(--blush),transparent);top:10%;left:5%;animation-delay:0s;"></div>
<div class="floating-shape" style="width:150px;height:150px;background:radial-gradient(var(--lavender),transparent);bottom:15%;right:8%;animation-delay:-7s;"></div>
<span class="floaty" style="top:15%;right:12%;animation-delay:0s;">ğŸŒ¸</span>
<span class="floaty" style="bottom:20%;left:8%;animation-delay:-5s;">âœ¨</span>
<span class="floaty" style="top:50%;right:5%;animation-delay:-10s;">ğŸ’Œ</span>
<span class="floaty" style="top:25%;left:12%;animation-delay:-3s;">ğŸ¦‹</span>

<!-- â”€â”€â”€ AUTH PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page active" id="authPage">
  <div class="auth-book">
    <div class="auth-inner">
      <div class="auth-title">My<span> Slambook</span> ğŸ““</div>
      <div class="auth-sub">where friends leave their mark âœ¨</div>

      <div class="auth-tabs">
        <button class="tab-btn active" onclick="switchTab('login')">Sign In</button>
        <button class="tab-btn" onclick="switchTab('register')">Create Book</button>
      </div>

      <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
        <div class="field-group">
          <label>Username</label>
          <input type="text" id="l-user" placeholder="your name here..." autocomplete="username"/>
        </div>
        <div class="field-group">
          <label>Password</label>
          <input type="password" id="l-pass" placeholder="shhh ğŸ¤«" autocomplete="current-password"/>
        </div>
        <div class="error-msg" id="loginErr"></div>
        <button class="auth-btn" type="submit">Open My Slambook ğŸ“–</button>
      </form>

      <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
        <div class="field-group">
          <label>Your Name</label>
          <input type="text" id="r-user" placeholder="what do friends call you?"/>
        </div>
        <div class="field-group">
          <label>Email</label>
          <input type="email" id="r-email" placeholder="your@email.com" autocomplete="email"/>
        </div>
        <div class="field-group">
          <label>Password (6+ chars)</label>
          <input type="password" id="r-pass" placeholder="make it secret ğŸ”’" autocomplete="new-password"/>
        </div>
        <div class="error-msg" id="regErr"></div>
        <button class="auth-btn" type="submit">Create My Slambook ğŸŒ¸</button>
      </form>
    </div>
  </div>
</div>

<!-- â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page" id="dashPage">
  <div class="dash-header">
    <div class="dash-logo">My<span> Slambook</span> ğŸ““</div>
    <div class="dash-user">
      <div class="user-bubble" id="userInitial">?</div>
      <span class="username-lbl" id="displayName"></span>
      <button class="logout-btn" onclick="handleLogout()">Sign Out</button>
    </div>
  </div>

  <div class="dash-body">
    <div class="link-card">
      <h3>Share Your Slambook ğŸ’Œ</h3>
      <p>Send this link to your friends â€” they'll fill it out just for you!</p>
      <div class="link-box">
        <span id="shareLink">Loading...</span>
        <button class="copy-btn" onclick="copyLink()">ğŸ“‹ Copy</button>
      </div>
    </div>

    <div class="section-head">ğŸ’Œ Slams I've Received</div>
    <div class="responses-grid" id="responsesGrid">
      <div class="empty-state">
        <span class="emoji">ğŸ“­</span>
        <h4>No slams yet!</h4>
        <p>Share your link and wait for the love to pour in~</p>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€â”€ FULL RESPONSE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="modal" onclick="closeModal(event)">
  <div class="modal-book" id="modalBook">
    <div class="modal-spine">
      <div class="modal-name" id="modalName"></div>
      <button class="close-btn" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-content" id="modalContent"></div>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ Save / Print This Page</button>
  </div>
</div>

<div id="toast"></div>

<script>
let currentUser = null;

/* â”€â”€â”€ TAB SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function switchTab(tab){
  document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',i===(tab==='login'?0:1)));
  document.getElementById('loginForm').classList.toggle('active',tab==='login');
  document.getElementById('registerForm').classList.toggle('active',tab==='register');
}

/* â”€â”€â”€ PAGE SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toast(msg,duration=2500){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),duration);
}

/* â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function handleLogin(e){
  e.preventDefault();
  const err=document.getElementById('loginErr');
  err.style.display='none';
  const username=document.getElementById('l-user').value.trim();
  const password=document.getElementById('l-pass').value;
  if(!username||!password){err.textContent='Please fill in all fields';err.style.display='block';return;}
  try{
    const r=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',
      body:JSON.stringify({username,password})});
    const d=await r.json();
    if(!r.ok){err.textContent=d.error;err.style.display='block';return;}
    currentUser=d;
    loadDashboard();
  }catch{err.textContent='Server error. Is Flask running?';err.style.display='block';}
}

async function handleRegister(e){
  e.preventDefault();
  const err=document.getElementById('regErr');
  err.style.display='none';
  const username=document.getElementById('r-user').value.trim();
  const email=document.getElementById('r-email').value.trim();
  const password=document.getElementById('r-pass').value;
  try{
    const r=await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',
      body:JSON.stringify({username,email,password})});
    const d=await r.json();
    if(!r.ok){err.textContent=d.error;err.style.display='block';return;}
    currentUser=d;
    loadDashboard();
  }catch{err.textContent='Server error. Is Flask running?';err.style.display='block';}
}

async function handleLogout(){
  await fetch('/api/logout',{method:'POST',credentials:'include'});
  currentUser=null;
  showPage('authPage');
}

/* â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loadDashboard(){
  document.getElementById('displayName').textContent=currentUser.username;
  document.getElementById('userInitial').textContent=currentUser.username[0].toUpperCase();
  const link=`${location.origin}/fill.html?s=${currentUser.slambook_token}`;
  document.getElementById('shareLink').textContent=link;
  showPage('dashPage');
  loadResponses();
}

function copyLink(){
  const link=document.getElementById('shareLink').textContent;
  navigator.clipboard.writeText(link).then(()=>toast('ğŸ“‹ Link copied! Share away~'));
}

async function loadResponses(){
  try{
    const r=await fetch('/api/my-responses',{credentials:'include'});
    if(!r.ok)return;
    const data=await r.json();
    renderResponses(data);
  }catch(e){console.error(e);}
}

const STICKERS=['ğŸŒ¸','ğŸ’Œ','âœ¨','ğŸ¦‹','ğŸŒˆ','â­','ğŸ’–','ğŸ€','ğŸ“','ğŸŒ™'];
function renderResponses(list){
  const grid=document.getElementById('responsesGrid');
  if(!list.length){
    grid.innerHTML=`<div class="empty-state"><span class="emoji">ğŸ“­</span><h4>No slams yet!</h4><p>Share your link and wait for the love to pour in~</p></div>`;
    return;
  }
  grid.innerHTML='';
  list.slice().reverse().forEach((r,i)=>{
    const card=document.createElement('div');
    card.className='r-card';
    card.style.animationDelay=(i*.07)+'s';
    card.style.borderTopColor=['var(--blush)','var(--lavender)','var(--mint)','var(--periwinkle)','#FFD6A5'][i%5];
    const sticker=STICKERS[i%STICKERS.length];
    card.innerHTML=`
      <span class="sticker">${sticker}</span>
      <div class="r-name">${esc(r.full_name)}</div>
      <div class="r-nick">${r.nickname?'"'+esc(r.nickname)+'"':''}</div>
      <div class="r-preview">${esc(r.message||r.vibe||'')}</div>
      <div><span class="r-badge">${esc(r.zodiac||'âœ¨')}</span></div>
      <div class="r-time">${esc(r.timestamp)}</div>
    `;
    card.addEventListener('click',()=>openModal(r,sticker));
    grid.appendChild(card);
  });
}

/* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openModal(r,sticker='ğŸŒ¸'){
  document.getElementById('modalName').textContent=(sticker+' '+esc(r.full_name));
  document.getElementById('modalContent').innerHTML=buildModalHTML(r);
  document.getElementById('modal').classList.add('open');
}
function closeModal(e){
  if(!e||e.target===document.getElementById('modal'))
    document.getElementById('modal').classList.remove('open');
}

function qrow(label,val){
  const v=val&&val.trim()?`<div class="q-value">${esc(val)}</div>`:`<div class="q-value empty">not answered</div>`;
  return `<div class="q-row"><span class="q-label">${label}</span>${v}</div>`;
}
function rapid(label,val){
  return `<div class="rapid-item"><div class="q-label">${label}</div><div class="q-value" style="font-size:1rem">${val?esc(val):'â€”'}</div></div>`;
}
function buildModalHTML(r){
  return `
  <div class="q-section">
    <div class="q-section-title">ğŸ’Œ Basic Details</div>
    ${qrow('Full Name',r.full_name)}${qrow('Nickname',r.nickname)}${qrow('Date of Birth',r.dob)}
    ${qrow('Zodiac Sign',r.zodiac)}${qrow('Contact',r.contact)}
  </div>
  <div class="q-section">
    <div class="q-section-title">â­ Favorites</div>
    ${qrow('Favorite Color',r.fav_color)}${qrow('Favorite Food',r.fav_food)}
    ${qrow('Favorite Movie / Series',r.fav_movie)}${qrow('Favorite Singer / Band',r.fav_singer)}
    ${qrow('Favorite Actor / Actress',r.fav_actor)}${qrow('Favorite Place',r.fav_place)}
    ${qrow('Favorite Subject',r.fav_subject)}${qrow('Favorite Hobby',r.fav_hobby)}
    ${qrow('Favorite Season',r.fav_season)}${qrow('Favorite Quote',r.fav_quote)}
  </div>
  <div class="q-section">
    <div class="q-section-title">ğŸ¯ Dreams & Goals</div>
    ${qrow('Biggest Goal in Life',r.goal)}${qrow('Dream Job',r.dream_job)}
    ${qrow('In 10 Yearsâ€¦',r.in_10_years)}${qrow('One Thing to Achieve',r.want_to_achieve)}
  </div>
  <div class="q-section">
    <div class="q-section-title">ğŸ’­ About Me</div>
    ${qrow('3 Words That Describe Me',r.three_words)}${qrow('Biggest Fear',r.biggest_fear)}
    ${qrow('Biggest Strength',r.strength)}${qrow('Hidden Talent',r.hidden_talent)}
    ${qrow('Most Embarrassing Moment',r.embarrassing_moment)}${qrow('Biggest Crush ğŸ˜',r.crush)}
  </div>
  <div class="q-section">
    <div class="q-section-title">ğŸ‘€ About Us</div>
    ${qrow('First Impression of You',r.first_impression)}${qrow('What Changed After Knowing You',r.what_changed)}
    ${qrow('Favorite Memory With You',r.fav_memory)}${qrow('What I Like Most About You',r.like_most)}
    ${qrow('What Annoys Me About You ğŸ˜…',r.annoys_me)}${qrow('Secret Between Just Us',r.secret_between_us)}
    ${qrow('If We Were a Movieâ€¦',r.movie_title)}
  </div>
  <div class="q-section">
    <div class="q-section-title">ğŸµ Just For You</div>
    ${qrow('Song I\'d Dedicate to You',r.dedicate_song)}${qrow('A Line From That Song',r.song_line)}
    ${qrow('Our Friendship Theme Song',r.theme_song)}
  </div>
  <div class="q-section">
    <div class="q-section-title">ğŸ”¥ Rapid Fire</div>
    <div class="rapid-grid">
      ${rapid('â˜• or ğŸµ',r.coffee_tea)}${rapid('ğŸŒ™ or â˜€ï¸',r.night_day)}
      ${rapid('ğŸ’• or ğŸ’°',r.love_money)}${rapid('ğŸ“ or ğŸ’¬',r.call_text)}
      ${rapid('â›°ï¸ or ğŸ–ï¸',r.mountains_beach)}${rapid('ğŸ™ˆ or ğŸ¦‹',r.intro_extro)}
    </div>
  </div>
  <div class="q-section">
    <div class="q-section-title">ğŸ’– One Last Thing</div>
    ${qrow('A Message For You',r.message)}
    <div class="q-row">
      <span class="q-label">Will You Remember Me?</span>
      <div class="q-value" style="color:var(--coral);font-size:1.4rem">${r.remember_me||'YES ğŸ’–'}</div>
    </div>
  </div>`;
}

function esc(s=''){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(async()=>{
  try{
    const r=await fetch('/api/me',{credentials:'include'});
    const d=await r.json();
    if(d.logged_in){currentUser=d;loadDashboard();}
  }catch{}
})();
</script>
</body>
</html>
